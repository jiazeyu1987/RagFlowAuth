# 环境切换功能使用指南

## 功能概述

tool.py 现在支持**环境下拉菜单**，可以方便地在测试服务器和正式服务器之间切换部署。

## 界面变化

### 之前（需要手动输入IP）
```
┌─────────────────────────────────────────────────┐
│ 服务器 IP: [172.30.30.57     ]  │  │
│ 用户名:   [root             ]  │  │ [保存配置] [测试连接] │
└─────────────────────────────────────────────────┘
```

### 现在（环境下拉菜单）
```
┌────────────────────────────────────────────────────────────┐
│ 环境: [正式服务器 ▼]     │ │  │  │  │ [保存配置] [测试连接] │
│                                                            │
│ ┌──────────────────────────────────────────────────────┐ │
│ │ 下拉选项:                                            │ │
│ │   - 正式服务器 (生产环境)                           │ │
│ │   - 测试服务器 (测试环境)                            │ │
│ │   - 本地开发 (本地开发环境)                          │ │
│ │                                                      │ │
│ │ 注意: IP字段始终可编辑，可手动修改任意环境的服务器IP │ │
│ └──────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

## 使用方法

### 1. 切换环境

**步骤**：
1. 点击"环境"下拉菜单
2. 选择目标环境（如"测试服务器"）
3. IP和用户名会自动更新
4. 点击 **[测试连接]** 验证连接

**示例**：
```
选择: 测试服务器
自动更新: IP → 172.30.30.xx, 用户名 → root
```

### 2. 修改服务器IP

**方法A：直接修改IP字段**（最简单）
1. 在环境下拉菜单中选择任意环境
2. IP和用户名字段始终可编辑
3. 直接在IP字段中修改为所需的服务器地址
4. 点击[保存配置]保存
5. 点击[测试连接]验证连接

**方法B：直接修改代码**（适合固定服务器）
```python
# 编辑 tool.py 第 75-78 行
"测试服务器": {
    "ip": "您的测试服务器IP",  # ← 修改这里
    "user": "root",
    "description": "测试环境"
},
```

**方法C：修改配置文件**
```bash
# 编辑配置文件
notepad C:\Users\BJB110\.ragflowauth_tool_config.txt

# 添加或修改：
SERVER_IP=您的测试服务器IP
ENVIRONMENT=测试服务器
```

**重要提示**：
- IP和用户名字段始终可编辑，可以在任何环境中手动修改
- 切换环境会自动填充预定义的IP，但之后仍可手动修改

### 3. 保存配置

切换环境后，点击 **[保存配置]** 按钮保存到文件：
- 配置文件位置：`C:\Users\BJB110\.ragflowauth_tool_config.txt`
- 保存内容：
  ```
  ENVIRONMENT=正式服务器
  SERVER_IP=172.30.30.57
  SERVER_USER=root
  ```

### 4. 部署流程

**推荐工作流**：

```
1. 本地开发完成
   ↓
2. 切换到"测试服务器"
   ↓
3. 点击[快速部署] → Tag: 1.2.0-test-feature-name
   ↓
4. 在测试服务器验证功能
   ↓
5. 切换到"正式服务器"
   ↓
6. 点击[快速部署] → Tag: 1.2.0-feature-name
   ↓
7. 在正式服务器验证功能
```

## 环境配置说明

### 预定义环境

| 环境名称 | IP地址 | 用途 | 备注 |
|---------|-------|------|------|
| **正式服务器** | 172.30.30.57 | 生产环境 | 当前默认 |
| **测试服务器** | 172.30.30.xx | 测试环境 | 需要修改IP |
| **本地开发** | localhost | 本地开发 | 用于本地测试 |

**注意**: 所有环境的IP字段均可手动修改

### 添加新环境

如果需要添加更多环境（如"预发布环境"），编辑 `tool.py` 第 69-84 行：

```python
ENVIRONMENTS = {
    "正式服务器": {
        "ip": "172.30.30.57",
        "user": "root",
        "description": "生产环境"
    },
    "测试服务器": {
        "ip": "172.30.30.xx",
        "user": "root",
        "description": "测试环境"
    },
    "本地开发": {
        "ip": "localhost",
        "user": "root",
        "description": "本地开发环境"
    },
    # 添加新环境
    "预发布服务器": {
        "ip": "172.30.30.yy",
        "user": "root",
        "description": "预发布环境"
    }
}
```

## 配置文件格式

### 配置文件位置
- Windows: `C:\Users\<用户名>\.ragflowauth_tool_config.txt`

### 配置文件示例
```
ENVIRONMENT=正式服务器
SERVER_IP=172.30.30.57
SERVER_USER=root
```

### 配置优先级
1. 配置文件中的 `ENVIRONMENT`（如果存在）
2. 如果配置文件中没有环境，使用 `SERVER_IP` 和 `SERVER_USER`

## 常见问题

### Q1: 切换环境后部署还是到旧服务器？

**A**: 检查以下几点：
1. 确认下拉菜单已切换
2. 确认IP地址已自动更新
3. 点击[测试连接]验证
4. 重新点击[快速部署]

### Q2: 如何临时连接到其他服务器？

**A**: 直接修改IP字段：
1. 下拉菜单选择任意环境（或保持当前环境）
2. 直接在IP字段中输入服务器地址
3. 点击[保存配置]
4. 点击[测试连接]验证

### Q3: 如何添加新的服务器环境？

**A**: 编辑 `tool.py` 第 69-84 行的 `ENVIRONMENTS` 字典

### Q4: 配置文件在哪里？

**A**: `C:\Users\BJB110\.ragflowauth_tool_config.txt`

### Q5: 如何恢复默认配置？

**A**: 删除配置文件后重启tool.py
```bash
del C:\Users\BJB110\.ragflowauth_tool_config.txt
python tool.py
```

## 版本兼容性

- ✅ 向后兼容：旧的配置文件仍然有效
- ✅ 自动迁移：自动加载旧配置并设置默认环境
- ✅ 灵活配置：IP字段始终可编辑

## 更新日志

### v1.2.0 - 环境切换功能
- ✅ 添加环境配置管理
- ✅ 添加环境下拉菜单
- ✅ 自动IP/用户名更新
- ✅ 增强的保存/加载配置
- ✅ 环境描述信息

### v1.2.1 - IP字段始终可编辑
- ✅ 移除IP字段只读限制
- ✅ 简化环境切换流程
- ✅ 更灵活的临时服务器连接
