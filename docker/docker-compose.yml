services:
  backend:
    image: ragflowauth-backend:${RAGFLOWAUTH_TAG:-local}
    build:
      context: ..
      dockerfile: backend/Dockerfile
    ports:
      - "8001:8001"
    volumes:
      - ../data:/app/data
      - ../ragflow_config.json:/app/ragflow_config.json:ro
      - ../ragflow_compose:/app/ragflow_compose:ro
      - ../backups:/app/data/backups
    environment:
      HOST: "0.0.0.0"
      PORT: "8001"
      DATABASE_PATH: "data/auth.db"
      UPLOAD_DIR: "data/uploads"
      # IMPORTANT: change in production
      JWT_SECRET_KEY: "${JWT_SECRET_KEY:-change-me-in-production}"

  frontend:
    image: ragflowauth-frontend:${RAGFLOWAUTH_TAG:-local}
    build:
      context: ..
      dockerfile: fronted/Dockerfile
    ports:
      - "8080:80"
    depends_on:
      - backend
