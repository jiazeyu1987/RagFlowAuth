# RagflowAuth 服务器管理工具

## 简介

`tool.py` 是一个图形化管理工具，用于远程管理 RagflowAuth 服务器。通过这个工具，你可以：

- ⚙️ 配置服务器连接信息（IP、用户名）
- 🔧 执行服务器端管理脚本
- 🌐 快速访问 Web 管理界面（Portainer、Web Console）
- 💾 管理备份和查看日志
- 🧹 清理 Docker 镜像和容器

## 功能特性

### 1. 服务器配置
- 默认服务器 IP: `172.30.30.57`
- 默认用户名: `root`
- 配置自动保存到 `~/.ragflowauth_tool_config.txt`
- 一键测试 SSH 连接

### 2. 工具选项卡
包含以下管理工具：

| 工具名称 | 说明 |
|---------|------|
| 清理 Docker 镜像 | 清理未使用的镜像（仅保留当前版本） |
| 清理 Docker 镜像（保留3个版本） | 保留最近 3 个版本用于回滚 |
| 快速重启容器 | 使用现有镜像快速重启 |
| 查看运行中的容器 | 列出所有运行中的容器 |
| 查看所有容器 | 列出所有容器（包括已停止） |
| 查看 Docker 镜像 | 列出所有镜像及大小 |
| 查看磁盘使用情况 | 显示 Docker 占用的磁盘空间 |
| 查看后端日志 | 显示后端容器日志 |
| 查看前端日志 | 显示前端容器日志 |
| 重启所有容器 | 重启 RagflowAuth 所有容器 |
| 停止所有容器 | 停止 RagflowAuth 所有容器 |
| 启动所有容器 | 启动 RagflowAuth 所有容器 |

### 3. Web 管理界面
快速访问以下 Web 界面：

- **Portainer** (http://172.30.30.57:9000)
  - Docker 容器可视化管理平台
  - 管理容器、镜像、网络、卷等

- **Web 管理界面** (https://172.30.30.57:9090/)
  - RagflowAuth 后台管理
  - 应用配置和监控

- **自定义 URL**
  - 输入任意 URL 快速打开

### 4. 备份管理
- 查看最近的备份
- 查看备份磁盘使用
- 查看 Windows 共享备份
- 检查 SMB 挂载状态

### 5. 日志查看
- 实时查看后端日志
- 实时查看前端日志
- 查看系统日志
- 查看 Docker 服务日志

## 使用方法

### 方法 1: 双击批处理文件（推荐）

```bash
# 双击 tool.bat
tool.bat
```

### 方法 2: 命令行运行

```bash
# 使用 Python 运行
python tool.py

# 或使用 pythonw（无控制台窗口）
pythonw tool.py
```

## 系统要求

- Python 3.x
- SSH 客户端（Windows 自带或需要安装 OpenSSH）
- 网络连接到服务器

## 配置说明

### 首次使用

1. 启动工具后，在顶部"服务器配置"区域输入：
   - 服务器 IP（默认: 172.30.30.57）
   - 用户名（默认: root）

2. 点击"保存配置"按钮

3. 点击"测试连接"按钮验证 SSH 连接

### 修改配置

如果需要连接到其他服务器：
1. 修改 IP 地址和用户名
2. 点击"保存配置"

配置会自动保存，下次启动时自动加载。

## 注意事项

### SSH 连接
- 确保你的机器可以 SSH 连接到服务器
- Windows 10/11 自带 OpenSSH 客户端
- 如果提示"ssh 不是内部或外部命令"，需要安装 OpenSSH Client

### 执行命令
- 所有命令都通过 SSH 在服务器上执行
- 某些命令可能需要 root 权限
- 执行时间较长的命令会显示进度

### 日志查看
- 实时日志会在新窗口中打开
- 按 Ctrl+C 可以停止日志输出
- 关闭日志窗口不会停止服务器进程

## 常见问题

### Q: 提示"ssh 不是内部或外部命令"
**A:** Windows 需要安装 OpenSSH Client：
1. 设置 → 应用 → 可选功能
2. 添加功能 → OpenSSH Client
3. 安装完成后重启命令行

### Q: 连接超时
**A:** 检查：
1. 服务器 IP 是否正确
2. 网络是否通畅
3. SSH 服务是否在服务器上运行
4. 防火墙是否允许 SSH 连接（端口 22）

### Q: 权限不足
**A:** 确保使用的用户有足够的权限执行 Docker 命令，建议使用 root 用户。

### Q: 命令执行无响应
**A:** 某些命令（如日志查看）会持续输出，需要在新窗口中查看或手动停止。

## 快捷键

- **Tab**: 切换选项卡
- **Ctrl+C**: 停止日志输出（在日志窗口中）
- **Esc**: 关闭日志窗口

## 文件结构

```
RagflowAuth/
├── tool.py                    # 主程序
├── tool.bat                   # 快捷启动脚本
└── tool/
    └── scripts/               # 服务器端脚本
        ├── cleanup-images.sh  # 清理 Docker 镜像
        ├── quick-restart.sh   # 快速重启
        └── ...
```

## 更新日志

### v1.0.0 (2025-01-26)
- ✅ 初始版本
- ✅ 服务器配置管理
- ✅ SSH 命令执行
- ✅ Web 界面快速访问
- ✅ 备份管理
- ✅ 日志查看

## 许可证

MIT License

## 贡献

欢迎提交问题和改进建议！
